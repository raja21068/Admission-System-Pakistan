<?xml version="1.0" encoding="UTF-8"?>
<views>
    <view name="DISCIPLINE_ALG_VIEW">
        <![CDATA[
        SELECT POS.PROGRAM_OF_STUDY_ID AS POS_ID, CPOS.CAMPUS_PROGRAM_OF_STUDY_ID AS CPOS_ID,
	CPOSG.CPOS_GROUP_ID AS CPOSG_ID, CPOS.CAMPUS_ID, S.SHIFT_ID, S.IS_MORNING, POS.IS_QUOTA_ORIENTED, CPOSG.GROUP_CODE
	FROM PROGRAM_OF_STUDY POS
	INNER JOIN CAMPUS_PROGRAM_OF_STUDY CPOS ON POS.PROGRAM_OF_STUDY_ID = CPOS.PROGRAM_OF_STUDY_ID
	INNER JOIN CPOS_GROUP CPOSG ON CPOSG.CAMPUS_PROGRAM_OF_STUDY_ID = CPOS.CAMPUS_PROGRAM_OF_STUDY_ID
	INNER JOIN SHIFT S ON S.SHIFT_ID = CPOS.SHIFT_ID
        ]]>
    </view>
    <view name="CANDIDATE_ALG_VIEW">
        <![CDATA[
        SELECT C.ADMISSION_YEAR_ID, C.PROGRAM_TYPE_ID, J.CAMPUS_ID, J.IS_JURISDICTION,
	C.CANDIDATE_ID AS ID, C.DISTRICT_ID, PV.CODE AS PROVINCE_CODE, C.SEAT_NO, C.GENDER, C.AREA,
	C.TEST_SCORE AS SCORE, C.PERCENTAGE, C.YEARS_DEGREE, C.IS_OBJECTION, 
	(SELECT CAST(GROUP_ AS UNSIGNED) FROM CREDENTIAL_DETAILS 
	 WHERE CANDIDATE_ID = C.CANDIDATE_ID AND DETAIL_OF = (SELECT MAX(DETAIL_OF) FROM CREDENTIAL_DETAILS WHERE CANDIDATE_ID = C.CANDIDATE_ID)
	) AS LAST_PROGRAM_ID,
	(SELECT GROUP_CONCAT(SUBJECT_ID) FROM OPTIONAL_SUBJECT 
	 WHERE CREDENTIAL_DETAILS_ID = (SELECT CREDENTIAL_DETAILS_ID FROM CREDENTIAL_DETAILS WHERE 
	 CANDIDATE_ID = C.CANDIDATE_ID AND DETAIL_OF = (SELECT MAX(DETAIL_OF) FROM CREDENTIAL_DETAILS WHERE CANDIDATE_ID = C.CANDIDATE_ID))
	) AS OPTIONAL_SUBJECT,
	(SELECT GROUP_CONCAT(CODE) FROM APPLIED_CATEGORY WHERE CANDIDATE_ID = C.CANDIDATE_ID) AS APPLIED_CATEGORY
	FROM CANDIDATE C
	INNER JOIN DISTRICT D ON D.DISTRICT_ID = C.DISTRICT_ID
	INNER JOIN JURISDICTION J ON J.DISTRICT_ID = D.DISTRICT_ID
	INNER JOIN DIVISION DV ON DV.DIVISION_ID = D.DIVISION_ID
	INNER JOIN PROVINCE PV ON PV.PROVINCE_ID = DV.PROVINCE_ID
	LEFT JOIN ADMISSION_LIST_DETAILS ALD ON C.CANDIDATE_ID = ALD.CANDIDATE_ID
	WHERE ALD.ADMISSION_LIST_DETAILS_ID IS NULL
	AND C.TEST_SCORE > 0

	UNION

	SELECT C.ADMISSION_YEAR_ID, C.PROGRAM_TYPE_ID, J.CAMPUS_ID, J.IS_JURISDICTION,
	C.CANDIDATE_ID AS ID, C.DISTRICT_ID, PV.CODE AS PROVINCE_CODE, C.SEAT_NO, C.GENDER, C.AREA,
	C.TEST_SCORE AS SCORE, C.PERCENTAGE, C.YEARS_DEGREE, C.IS_OBJECTION, 
	(SELECT CAST(GROUP_ AS UNSIGNED) FROM CREDENTIAL_DETAILS 
	 WHERE CANDIDATE_ID = C.CANDIDATE_ID AND DETAIL_OF = (SELECT MAX(DETAIL_OF) FROM CREDENTIAL_DETAILS WHERE CANDIDATE_ID = C.CANDIDATE_ID)
	) AS LAST_PROGRAM_ID,
	(SELECT GROUP_CONCAT(SUBJECT_ID) FROM OPTIONAL_SUBJECT 
	 WHERE CREDENTIAL_DETAILS_ID = (SELECT CREDENTIAL_DETAILS_ID FROM CREDENTIAL_DETAILS WHERE 
	 CANDIDATE_ID = C.CANDIDATE_ID AND DETAIL_OF = (SELECT MAX(DETAIL_OF) FROM CREDENTIAL_DETAILS WHERE CANDIDATE_ID = C.CANDIDATE_ID))
	) AS OPTIONAL_SUBJECT,
	(SELECT GROUP_CONCAT(CODE) FROM APPLIED_CATEGORY WHERE CANDIDATE_ID = C.CANDIDATE_ID) AS APPLIED_CATEGORY
	FROM CANDIDATE C
	INNER JOIN DISTRICT D ON D.DISTRICT_ID = C.DISTRICT_ID
	INNER JOIN JURISDICTION J ON J.DISTRICT_ID = D.DISTRICT_ID
	INNER JOIN DIVISION DV ON DV.DIVISION_ID = D.DIVISION_ID
	INNER JOIN PROVINCE PV ON PV.PROVINCE_ID = DV.PROVINCE_ID
	INNER JOIN ADMISSION_LIST_DETAILS ALD ON ALD.CANDIDATE_ID = C.CANDIDATE_ID
	INNER JOIN PART_REGISTRY PR ON PR.ADMISSION_LIST_DETAILS_ID = ALD.ADMISSION_LIST_DETAILS_ID
	WHERE ALD.ADMISSION_LIST_DETAILS_ID IS NOT NULL
	AND ALD.ADMISSION_LIST_DETAILS_ID NOT IN (SELECT ADMISSION_LIST_DETAILS_ID FROM PART_REGISTRY WHERE TYPE = 1)
	AND C.TEST_SCORE > 0
        ]]>
    </view>
    <view name="CANDIDATE_DETAIL_CHECKER_VIEW">
        <![CDATA[SELECT C.CANDIDATE_ID AS ID, C.ADMISSION_YEAR_ID, C.PROGRAM_TYPE_ID, C.SEAT_NO, 
	C.GENDER, C.NAME, C.FATHERS_NAME, C.SURNAME, D.NAME AS DISTRICT,  C.AREA,
	(SELECT GROUP_CONCAT(CODE) FROM APPLIED_CATEGORY WHERE CANDIDATE_ID = C.CANDIDATE_ID) AS APPLIED_CATEGORIES,
	U.FIRST_NAME AS USER, C.OBJECTION_REMARKS, C.REMARKS AS CHALAN_NO, C.CHALAN_FEE, C.CHALAN_DATE, IFNULL(C.YEARS_DEGREE, 0) AS YEARS_DEGREE
	FROM CANDIDATE AS C
	INNER JOIN DISTRICT AS D ON C.DISTRICT_ID = D.DISTRICT_ID
	INNER JOIN YOG_LOG AS LOG ON LOG.MODEL_ID = C.CANDIDATE_ID
	INNER JOIN YOG_USER AS U ON U.ID = LOG.USER_ID
	WHERE LOG.MODEL_ACTION = 'ADD' AND LOG.MODEL_NAME = 'Candidate']]>
    </view>
    <view name="CANDIDATE_CHOICES_CHECKER_VIEW">
        <![CDATA[SELECT CNPOS.CANDIDATE_PROGRAM_OF_STUDY_ID AS ID, CNPOS.CANDIDATE_ID, CM.NAME AS CAMPUS, S.NAME AS SHIFT, 
	GROUP_CONCAT(POS.CODE order by CNPOS.CHOICE_NO) AS CHOICES, 
	GROUP_CONCAT(CNPOS.CHOICE_NO order by CNPOS.CHOICE_NO) AS CHOICES_NO, 
	S.IS_MORNING, CM.DISPLAY_ORDER
	FROM CANDIDATE_PROGRAM_OF_STUDY AS CNPOS
	INNER JOIN CAMPUS_PROGRAM_OF_STUDY AS CPOS ON CNPOS.CAMPUS_PROGRAM_OF_STUDY_ID = CPOS.CAMPUS_PROGRAM_OF_STUDY_ID
	INNER JOIN PROGRAM_OF_STUDY AS POS ON CPOS.PROGRAM_OF_STUDY_ID = POS.PROGRAM_OF_STUDY_ID
	INNER JOIN CAMPUS AS CM ON CM.CAMPUS_ID = CPOS.CAMPUS_ID
	INNER JOIN SHIFT AS S ON S.SHIFT_ID = CPOS.SHIFT_ID
	WHERE POS.CODE <> '' AND POS.CODE IS NOT NULL
	GROUP BY CNPOS.CANDIDATE_ID, CM.NAME, S.NAME]]>
    </view>
    <view name="YOGV_SELECTION_LIST">
        <![CDATA[SELECT ALD.ADMISSION_LIST_DETAILS_ID AS ID, C.CANDIDATE_ID, CM.NAME AS CAMPUS, CM.LOCATION AS CAMPUS_LOCATION, S.NAME AS SHIFT, POS.NAME AS DISCIPLINE, P.NAME AS PROGRAM, 
	C.SEAT_NO, C.NAME, C.FATHERS_NAME, D.NAME AS DISTRICT, C.AREA, CNPOS.CHOICE_NO, C.DEDUCTION_MARKS, C.TEST_SCORE, 
	C.PERCENTAGE, CAT.NAME AS CATEGORY, ALD.ADMISSION_LIST_ID, CMC.DISPLAY_ORDER AS CAT_DISPLAY_ORDER, ALD.SEL_CAT
	FROM ADMISSION_LIST_DETAILS ALD
	INNER JOIN CANDIDATE C ON C.CANDIDATE_ID = ALD.CANDIDATE_ID
	INNER JOIN DISTRICT D ON C.DISTRICT_ID = D.DISTRICT_ID
	INNER JOIN CANDIDATE_PROGRAM_OF_STUDY CNPOS ON CNPOS.CANDIDATE_PROGRAM_OF_STUDY_ID = ALD.CANDIDATE_PROGRAM_OF_STUDY_ID
	INNER JOIN CPOS_GROUP CPOSG ON ALD.CPOS_GROUP_ID = CPOSG.CPOS_GROUP_ID
	INNER JOIN CAMPUS_PROGRAM_OF_STUDY CPOS ON CPOSG.CAMPUS_PROGRAM_OF_STUDY_ID = CPOS.CAMPUS_PROGRAM_OF_STUDY_ID
	INNER JOIN PROGRAM_OF_STUDY POS ON CPOS.PROGRAM_OF_STUDY_ID = POS.PROGRAM_OF_STUDY_ID
	INNER JOIN PROGRAM P ON POS.PROGRAM_ID = P.PROGRAM_ID
	INNER JOIN CAMPUS CM ON CPOS.CAMPUS_ID = CM.CAMPUS_ID
	INNER JOIN SHIFT S ON CPOS.SHIFT_ID = S.SHIFT_ID
	INNER JOIN CAMPUS_CATEGORY CMC ON CMC.CAMPUS_CATEGORY_ID = ALD.CAMPUS_CATEGORY_ID
	INNER JOIN CATEGORY CAT ON CMC.CATEGORY_ID = CAT.CATEGORY_ID]]>
    </view>
    <view name="YOGV_CANDIDATE_ADMISSION_DETAIL">
        <![CDATA[SELECT ALD.ADMISSION_LIST_DETAILS_ID AS ID, ALD.ADMISSION_LIST_ID, C.CANDIDATE_ID, C.ADMISSION_YEAR_ID, IF(PT.IS_BACHELOR = 1, 0, 1) AS PROGRAM_TYPE,
	CPOSG.CPOS_GROUP_ID, CPOS.CAMPUS_PROGRAM_OF_STUDY_ID, POS.PROGRAM_OF_STUDY_ID, P.PROGRAM_ID, D.DISCIPLINE_ID,
	DP.DEPARTMENT_ID, F.FACULTY_ID, IF(POS.IS_QUOTA_ORIENTED = 1, 0, 1) AS ORIENTED, POS.DURATION, POS.SEMESTER, ALD.SEL_CAT AS CATEGORY, IF(S.IS_MORNING = 1, 0, 1) AS SHIFT,
        (SELECT COUNT(PR.PROVINCE_ID) 
         FROM PROVINCE PR 
         INNER JOIN DIVISION DI ON PR.PROVINCE_ID = DI.PROVINCE_ID
         INNER JOIN DISTRICT DS ON DS.DIVISION_ID = DI.DIVISION_ID
         WHERE DS.DISTRICT_ID = C.DISTRICT_ID AND PR.NAME = 'SINDH') AS IS_NON_SINDH,
        (SELECT I.IS_JURISDICTION FROM ISSUER I INNER JOIN CREDENTIAL_DETAILS CD ON CD.ISSUER_ID = I.ISSUER_ID
	 WHERE CANDIDATE_ID = C.CANDIDATE_ID AND DETAIL_OF = (SELECT MAX(DETAIL_OF) FROM CREDENTIAL_DETAILS WHERE CANDIDATE_ID = C.CANDIDATE_ID)
	) AS IS_BOARD_JURISDICTION,
        C.NAME, C.FATHERS_NAME, C.SEAT_NO, D.NAME AS DISCIPLINE, P.NAME AS PROGRAM
	FROM ADMISSION_LIST_DETAILS ALD
	INNER JOIN CANDIDATE C ON ALD.CANDIDATE_ID = C.CANDIDATE_ID
	INNER JOIN CPOS_GROUP CPOSG ON ALD.CPOS_GROUP_ID = CPOSG.CPOS_GROUP_ID
	INNER JOIN CAMPUS_PROGRAM_OF_STUDY CPOS ON CPOSG.CAMPUS_PROGRAM_OF_STUDY_ID = CPOS.CAMPUS_PROGRAM_OF_STUDY_ID
	INNER JOIN PROGRAM_OF_STUDY POS ON CPOS.PROGRAM_OF_STUDY_ID = POS.PROGRAM_OF_STUDY_ID
	INNER JOIN PROGRAM P ON POS.PROGRAM_ID = P.PROGRAM_ID
	INNER JOIN PROGRAM_TYPE PT ON C.PROGRAM_TYPE_ID = PT.PROGRAM_TYPE_ID AND P.PROGRAM_TYPE_ID = PT.PROGRAM_TYPE_ID
	INNER JOIN DISCIPLINE D ON POS.DISCIPLINE_ID = D.DISCIPLINE_ID
	INNER JOIN DEPARTMENT DP ON D.DEPARTMENT_ID = DP.DEPARTMENT_ID
	INNER JOIN FACULTY F ON DP.FACULTY_ID = F.FACULTY_ID
	INNER JOIN SHIFT S ON CPOS.SHIFT_ID = S.SHIFT_ID]]>
    </view>
</views>
